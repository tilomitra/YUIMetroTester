# -- Constants -----------------------------------------------------------------

# Path to the normalize.css git repo.
NORMALIZE_LIB = $(PWD)/../../../normalize.css

# Path to which Normalize CSS files should be written.
OUTPUT_DIR = $(PWD)/css

# Path to which manual test files should be written.
TESTS_DIR = $(PWD)/tests/manual

# Comment to prepend to the imported source files.
PREPEND_COMMENT = /*! Copyright (c) Nicolas Gallagher and Jonathan Neal */ \n /* THIS FILE IS GENERATED BY A BUILD SCRIPT - DO NOT EDIT! */\n

# Files that make up normalize.css 
BASE_FILES = $(NORMALIZE_LIB)/normalize.css 

# Test file from normalize.css repo
TEST_FILES = $(NORMALIZE_LIB)/test.html

# -- Targets -------------------------------------------------------------------

BASE_TARGETS = $(addprefix $(OUTPUT_DIR)/, $(notdir $(BASE_FILES)))
TEST_TARGETS = $(addprefix $(TESTS_DIR)/, $(notdir $(TEST_FILES)))

# target: all - Default target.
all: import

# target: clean - Removes imported source files.
clean:
	rm -f $(BASE_TARGETS) $(TEST_TARGETS)

# target: import - Imports normalize.css source files from a separate repo.
import: import-base import-tests


# target: import-base - Imports the source files that make up normalize.css.
import-base: $(BASE_TARGETS)

# target: import-base - Imports the source files that make up normalize.css.
import-tests: $(TEST_TARGETS)

# target: help - Displays help.
help:
	@egrep "^# target:" Makefile

$(OUTPUT_DIR)/%.css: $(NORMALIZE_LIB)/%.css
	@echo "Copying CSS contents over..."
	@echo "$(notdir $@)"
	@echo "$(PREPEND_COMMENT)" > $@
	cat $(BASE_FILES) >> $@
	node make-context.js

$(TESTS_DIR)/%.html: $(NORMALIZE_LIB)/%.html
	@echo "Copying test contents over..."
	@echo "$(notdir $@)"
	cat $(TEST_FILES) >> $@
